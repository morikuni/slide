theme: Plain Jane, 3
autoscale: true

# [fit] DDD(ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ)å…¥é–€
# @morikuni

---

# DDDã¨ã¯

---

# ãƒ¢ãƒ‡ãƒ«é§†å‹•è¨­è¨ˆ +
# ã‚¨ã‚¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° + Î±

- ã‚³ãƒ¼ãƒ‰ã§ã¯ãªãå‰ã«ãƒ¢ãƒ‡ãƒ«ã‚’è¨­è¨ˆã™ã‚‹
- ãƒ¢ãƒ‡ãƒ«ã¨ã‚³ãƒ¼ãƒ‰ã‚’ä¸€è‡´ã•ã›ã‚‹
- ç¶™ç¶šçš„ã«ãƒ¢ãƒ‡ãƒ«(ã¨ã‚³ãƒ¼ãƒ‰)ã‚’è¦‹ç›´ã™
- ãƒãƒ¼ãƒ å†…ã§ä½¿ã†è¨€è‘‰ã‚’çµ±ä¸€ã™ã‚‹(ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªž)

---

# ãƒ¢ãƒ‡ãƒ«ã¨ã¯

---

> ãƒ¢ãƒ‡ãƒ«ã¨ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æºã‚ã‚‹äººã€…ã®é ­ã®ä¸­ã§æ§‹ç¯‰ã•ã‚ŒãŸæ¦‚å¿µã®é›†ã¾ã‚Šã§ã‚ã‚‹
-- ã‚¨ãƒªãƒƒã‚¯ãƒ»ã‚¨ãƒ´ã‚¡ãƒ³ã‚¹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ

---

> å•é¡Œã‚’è§£æ±ºã™ã‚‹ä¸Šã§é–¢é€£ã™ã‚‹å´é¢ã‚’æŠ½è±¡åŒ–ã—ã€ãã‚Œä»¥å¤–ã®è©³ç´°ã‚’ç„¡è¦–ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦è¡Œã‚ã‚ŒãŸã€ç¾å®Ÿã«å¯¾ã™ã‚‹1ã¤ã®è§£é‡ˆãªã®ã ã€‚
-- ã‚¨ãƒªãƒƒã‚¯ãƒ»ã‚¨ãƒ´ã‚¡ãƒ³ã‚¹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ

---

# ãƒ¢ãƒ‡ãƒ«ã¨ã¯

- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸Šã«ç¾ã‚Œã‚‹æ¦‚å¿µã§ã‚ã‚‹
- ãƒãƒ¼ãƒ å†…ã®å…¨å“¡ã®å…±é€šã®èªè­˜ã§ã‚ã‚Šã€ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªžã‚’æ”¯ãˆã‚‹
- ã‚³ãƒ¼ãƒ‰ã«ã‚‚ãƒ¢ãƒ‡ãƒ«ãŒãã®ã¾ã¾ç¾ã‚Œã‚‹
- ãƒ¢ãƒ‡ãƒ«ãŒå¤‰ã‚ã‚Œã°ã‚³ãƒ¼ãƒ‰ã‚‚å¤‰ã‚ã‚Šã€ã‚³ãƒ¼ãƒ‰ãŒå¤‰ã‚ã‚Œã°ãƒ¢ãƒ‡ãƒ«ã‚‚å¤‰ã‚ã‚‹

---

# DDDãŒç›®æŒ‡ã™ã‚‚ã®

---

# DDDãŒç›®æŒ‡ã™ã‚‚ã®

## ãƒ“ã‚¸ãƒã‚¹ã®é€²åŒ–ã‚’æ”¯ãˆã‚‹

- æŠ€è¡“è€…ãŒãƒ‡ãƒ¼ã‚¿ã®å‡ºã—å…¥ã‚Œã‚’æ„è­˜ã—ãŸå®Ÿè£…ã‚’è¡Œã†ã¨ã€ãƒ¢ãƒ‡ãƒ«ã¨å®Ÿè£…ãŒä¹–é›¢ã™ã‚‹
- ãƒ¢ãƒ‡ãƒ«ã®ä¿®æ­£ã«ã‚ˆã‚‹å½±éŸ¿ç¯„å›²ã®èª¿æŸ»ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã€ãƒ“ã‚¸ãƒã‚¹ã®å¤‰åŒ–ã«ã‚³ãƒ¼ãƒ‰ã®å¤‰åŒ–ãŒè¿½ã„ã¤ã‘ãªããªã‚‹
- ãƒ¢ãƒ‡ãƒ«ã¨å®Ÿè£…ãŒä¸€è‡´ã—ã¦ã„ã‚Œã°ã€ãƒ¢ãƒ‡ãƒ«ã®ä¿®æ­£ã¨å½±éŸ¿èª¿æŸ»ã¯1ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã«ãªã‚‹

---

# DDDãŒç›®æŒ‡ã™ã‚‚ã®

## ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®ç†è§£ã‚’æ·±ã‚ã‚‹

- ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã«ã¯ãƒ“ã‚¸ãƒã‚¹ã«ã¤ã„ã¦ç†è§£ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
- ãƒ¢ãƒ‡ãƒ«ã«ã¯æŠ€è¡“çš„åˆ¶ç´„ã‚‚åæ˜ ã•ã‚Œãªãã¦ã¯ãªã‚‰ãªã„ãŸã‚ã€æŠ€è¡“ã¨ãƒ“ã‚¸ãƒã‚¹ã¨ã®å¦¥å”ç‚¹ã«ã¤ã„ã¦æ·±ãè€ƒå¯Ÿã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- è€ƒå¯Ÿã¨ä¿®æ­£ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã§æœ€çµ‚çš„ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã®çŸ¥è­˜ã‚’æ­£ç¢ºã«åæ˜ ã—ãŸãƒ¢ãƒ‡ãƒ«ãŒæ‰‹ã«å…¥ã‚‹

---

# DDDãŒç›®æŒ‡ã™ã‚‚ã®

## ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å††æ»‘ã«ã™ã‚‹

- ãƒ¢ãƒ‡ãƒ«ã¯ä¼ç”»è€…ã‹ã‚‰æŠ€è¡“è€…(ã¨ã‚³ãƒ¼ãƒ‰)ã¾ã§å…¨ã¦ã®äººã«å…±æœ‰ã•ã‚Œã€ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªž(ã‚ãŸã‚Šã¾ãˆã«ä½¿ã‚ã‚Œã‚‹è¨€è‘‰)ã¨ãªã‚‹
- ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªžã«ã‚ˆã‚Šã€ä½¿ã‚ã‚Œã‚‹è¨€è‘‰ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã®ãƒ‡ãƒ¼ãƒ–ãƒ«ãªã©ã«ç¿»è¨³ã™ã‚‹ã“ã¨ãªãä¼šè©±ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹
- ã‚‚ã—ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªžãŒä¸è‡ªç„¶ã«æ„Ÿã˜ã‚‹ã®ã§ã‚ã‚Œã°ã€ãƒ¢ãƒ‡ãƒ«ãŒæ­£ç¢ºã§ã¯ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹

---

# ã©ã†ã‚„ã£ã¦DDDã§å®Ÿè£…ã™ã‚‹ã®ã‹ï¼Ÿ

---

# DDDã®æˆ¦è¡“çš„è¦ç´ 

- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®éš”é›¢ (ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾ (ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£, ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ, ã‚µãƒ¼ãƒ“ã‚¹, ä»•æ§˜)
- ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ç®¡ç† (é›†ç´„, ãƒªãƒã‚¸ãƒˆãƒª, ãƒ•ã‚¡ã‚¯ãƒˆãƒª)
- ã‚µãƒãƒ¼ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ, CQRS, Event Sourcing)

---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ã®éš”é›¢

---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ã®éš”é›¢

- ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’è²¬å‹™ã®å˜ä½ã§ã„ãã¤ã‹ã®å±¤ã«åˆ†é›¢ã—ã€å„å±¤ã®ä¾å­˜ã‚’1æ–¹å‘ã«é™å®šã™ã‚‹
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒUIã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ã®æŠ€è¡“çš„è¦ç´ ã«ã‚ˆã£ã¦è¤‡é›‘åŒ–ã™ã‚‹ã“ã¨ã‚’é¿ã‘ã‚‹

---

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

|ãƒ¬ã‚¤ãƒ¤ãƒ¼|è²¬å‹™|
| :--- | :--- |
|ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤|ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„å¤–éƒ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã«æ©Ÿèƒ½(ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹)ã‚’æä¾›ã™ã‚‹ã€‚APIã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã©ã€å¤–éƒ¨ã¨ã®æŽ¥ç‚¹1ã¤ã«ã¤ã1ã¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒç”¨æ„ã•ã‚Œã‚‹ã€‚|
|ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤|ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è§£é‡ˆã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«å‡¦ç†ã‚’å§”è­²ã™ã‚‹ã€‚æ©Ÿèƒ½1ã¤ã«ã¤ã1ã¤ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒç”¨æ„ã•ã‚Œã‚‹ã€‚|
|ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤|ãƒ‰ãƒ¡ã‚¤ãƒ³ã®çŠ¶æ…‹ã‚’åæ˜ ã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã€‚|
|ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ¼å±¤|ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ãªã©ã€æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã™ã‚‹ã€‚|

---

# ãƒ‰ãƒ¡ã‚¤ãƒ³ã®éš”é›¢

## ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä»²é–“

- ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£(ç´¹ä»‹ã—ãŸã‚‚ã®)
    - ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã‚’ä¸€ç•ªä¸Šã«æŒã£ã¦ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ã‚ã‚‹(DIP)
- ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

---

# ðŸš”ðŸ‘®
# ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æŽ¡ç”¨ã—ãŸã‹ã‚‰ã¨ã„ã£ã¦DDDã§ã¯ãªã„

---

# ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾

---

# ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾

ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¯æ¬¡ã®ã„ãšã‚Œã‹ã«åˆ†é¡žã§ãã‚‹ã€‚

- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- (ä»•æ§˜)
- ã‚µãƒ¼ãƒ“ã‚¹

åŒã˜è¨€è‘‰ã§è¡¨ã•ã‚Œã‚‹ãƒ¢ãƒ‡ãƒ«ã§ã‚‚ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã‚ˆã£ã¦åˆ¥ã®è¡¨ç¾ã«ãªã‚‹ã€‚

---

# ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾

## ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

- åˆ¥å å‚ç…§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- è­˜åˆ¥å­ã«ã‚ˆã£ã¦åŒä¸€æ€§ãŒå®šç¾©ã•ã‚Œã‚‹ã‚‚ã®
- è­˜åˆ¥å­ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ§‹æˆã•ã‚Œã‚‹
- `FindByXXX` ã§1ä»¶ã«çµžã‚Œã‚‹ã‚‚ã®ã¯ã»ã¨ã‚“ã©ãŒã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- ä¾‹: User, Account, Ticket

---

```go
type UserID int

type User struct {
    ID       UserID
    Profile  Profile
    PersonID PersonID
}

// è¤‡æ•°ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰è­˜åˆ¥å­ãŒæ§‹æˆã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹
type TicketID struct {
    EventID      EventID
    SerialNumber SerialNumber
}

type Ticket struct {
    ID     TicketID
    UserID UserID
}
```

---

# ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾

## ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

- å±žæ€§ã«ã‚ˆã£ã¦åŒä¸€æ€§ãŒå®šç¾©ã•ã‚Œã‚‹ã‚‚ã®
- ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å€¤(int, string...)ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è­˜åˆ¥å­ã€ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ§‹æˆã•ã‚Œã‚‹
- **å…¨ã¦ã®å±žæ€§ã®çµ„ã¿åˆã‚ã›**ã«ã‚ˆã£ã¦åˆã‚ã¦UNIQUEã«ãªã‚Œã‚‹
- ã„ãã¤ã‹ã®å±žæ€§ã§UNIQUEã«ãªã‚Œã‚‹ãªã‚‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‹ã‚‚ã—ã‚Œãªã„
- ä¾‹: Profile, Money, Location

---

```go
type Name string

type Profile struct {
    Name        Name   // Nameã¯Næ–‡å­—åˆ¶é™ãŒã‚ã‚‹ã®ã§åˆ¥ã®ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã™ã‚‹
    Description string // Descriptionã¯åˆ¶é™ãŒãªã„ã®ã§stringã§ã„ã„
    Icon        URL
}

type Location struct {
    Latitude  Latitude
    Longitude Longitude
}

func (a Location) DistanceTo(b Location) Distance {
    // geometricã¯åœ°çƒä¸Šã®2åœ°ç‚¹é–“ã®è·é›¢ã‚’è¨ˆç®—ã—ã¦ãã‚Œã‚‹ä»®æƒ³ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
    return Distance(geometric.Distance(a.Latitude, a.Longitude, b.Latitude, b.Longitude))
}

type Distance uint
```

---

# ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾

## ä»•æ§˜

- ç‰¹å®šã®ãƒ¢ãƒ‡ãƒ«ã«å¯¾ã™ã‚‹ä»•æ§˜ã‚’è¡¨ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€ç¨®ã¨ã—ã¦è¡¨ç¾ã•ã‚Œã‚‹ãŒã€ãƒ¢ãƒ‡ãƒ«ã®æ¤œè¨¼ã€é¸æŠžã€ç”Ÿæˆã‚’ã™ã‚‹å‡¦ç†ãŒä¸»å½¹
- Validateã‚„IsSatisfiedã¨ã„ã£ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤
- ä¾‹: äºˆç®—ã‚„æ—¥ç¨‹ã‹ã‚‰å®¿æ³Šãƒ—ãƒ©ãƒ³ã®æ¤œè¨¼

---

```go
type StayPlanSpecification struct {
    Budget   Money
    Schedule Period
}

// å®¿æ³Šãƒ—ãƒ©ãƒ³ãŒä»•æ§˜ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹æ¤œè¨¼ã™ã‚‹
func (spec StayPlanSpecification) Validate(plan StayPlan) error {
    if plan.Charge().IsOver(spec.Budget) {
        return ChageOverBudgetError()
    }
    if !plan.HasAnyEmptyRoomIn(spec.Schedule) {
        return ThereIsNoEmptyRoomError()
    }
    return nil
}

type StayPlanList []StayPlan

// ä»•æ§˜ã‹ã‚‰å®¿æ³Šãƒ—ãƒ©ãƒ³ã‚’é¸æŠžã™ã‚‹
func (list StayPlanList) Select(spec StayPlanSpecification) StayPlanList {
    result := StayPlanList{}
    for _, plan := range list {
        if spec.Validate(plan) == nil {
            result = append(result, plan)
        }
    }
    return result
}
```

---

```go
type NameSpecification struct {
    MinLength uint
    MaxLength uint
    NgWords   []string
}

func (spec NameSpecification) Validate(name Name) error {
    if len(name) > spec.MaxLength {
        return NameTooLongError()
    }
    if len(name) < spec.MinLength {
        return NameTooShortError()
    }
    for _, ng := range spec.NgWords {
        if strings.Contains(name, ng) {
            return NameContainsNgWordError()
        }
    }
    return nil
}

# ä»•æ§˜ã‹ã‚‰Nameã‚’ç”Ÿæˆã™ã‚‹
func GenerateRandomName(spec NameSpecification) Name {
    for {
        name := Name(rand.String()) // rand.String()ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ä»®æƒ³ã®é–¢æ•°
        if spec.Validate(name) == nil {
            return name
        }
    }
}
```

---

# ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾

## ã‚µãƒ¼ãƒ“ã‚¹

- å±žæ€§ã‚„è­˜åˆ¥å­ã‚’æŒãŸãªã„ã€ãŸã ã®å‡¦ç†
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‹ã«ã¯ä¸è‡ªç„¶ãªå‡¦ç†ã‚’è¡Œã†
- å‹•è©žã«ã¡ãªã‚“ã åå‰ãŒã¤ã‘ã‚‰ã‚Œã‚‹
- æ‰‹ç¶šãåž‹ã®ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ããŸã‚å¤šç”¨ã™ã¹ãã§ã¯ãªã„
- ä¾‹: MoneyTransferService (not AccountService)

---

```go
// é€é‡‘å…ƒãŒé€é‡‘å…ˆã®å£åº§ã‚’æ“ä½œã™ã‚‹ã®ã¯ä¸è‡ªç„¶ãªã®ã§ã‚µãƒ¼ãƒ“ã‚¹ã«ã™ã‚‹
type MoneyTransferService struct{}

func (s MoneyTransferService) Transfer(from, to Account, money Money) {
    from.Withdraw(money)
    to.Deposit(money)
}
```

---

# ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ç®¡ç†

---

# ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ç®¡ç†

- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ç”Ÿæˆã•ã‚ŒãŸã‚ã¨ã€æ°¸ç¶šåŒ–ã•ã‚Œã€å‰Šé™¤ã•ã‚Œã‚‹
- ãã®é–“ã«ä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨é–¢ã‚ã‚Šåˆã†ã“ã¨ã«ãªã‚‹ãŒã€ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦ã®æ•´åˆæ€§ã¯ä¿ãŸã‚Œç¶šã‘ãªã‘ã‚Œã°ãªã‚‰ãªã„
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’é€šã—ã¦ã©ã®ã‚ˆã†ã«æ•´åˆæ€§ã‚’ä¿ã¡ç¶šã‘ã‚‹ã‹ãŒå•é¡Œã¨ãªã‚‹

---

# ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ç®¡ç†

## é›†ç´„

- å¼·æ•´åˆæ€§(ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ•´åˆæ€§)ã®å˜ä½
- 1ã¤ã®ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨è¤‡æ•°ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ§‹æˆã•ã‚Œã‚‹
- ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒå‰Šé™¤ã•ã‚ŒãŸã‚‰ã€å†…éƒ¨ã®ãƒ¢ãƒ‡ãƒ«ã‚‚å‰Šé™¤ã•ã‚Œã‚‹
- å¤–éƒ¨ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹ã®ã¯ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã¿
- ä¾‹: Group(Group, GroupMember), Order(Order, OderItem)

---

```go
type Group struct {
    ID              GroupID
    MemberCount     uint
    GroupMemberList GroupMemberList
}

func (g *Group) AddMember(user User) {
    g.GroupMemberList.Add(g.CreateGrouopMember(user))
}

func (g *Group) CreateGrouopMember(user User) {
    // MemberCountã¨GroupMemberListå†…ã®æ•°ãŒå¸¸ã«ä¸€è‡´ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
    g.MemberCount++
    return GroupMember{
        ID: GroupMemberID{
            GroupID: g.ID,
            ID:      g.MemberCount,
        },
        UserID: user.ID,
    }
}

# GroupMemberIDã¯Groupå†…ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªè­˜åˆ¥å­
type GroupMemberID struct {
    GroupID GroupID
    ID      uint
}

type GroupMember struct {
    ID     GroupMemberID
    UserID UserID
}
```

---

# ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ç®¡ç†

## ãƒªãƒã‚¸ãƒˆãƒª

- ãƒ¢ãƒ‡ãƒ«ã®æ°¸ç¶šåŒ–ã€æ¤œç´¢ã‚’æŠ½è±¡åŒ–ã™ã‚‹
- é›†ç´„1ã¤ã«ã¤ããƒªãƒã‚¸ãƒˆãƒªã‚’1ã¤ç”¨æ„ã™ã‚‹
- ç‰¹å®šã®æ°¸ç¶šåŒ–æŠ€è¡“ã«ä¾å­˜ã—ã™ãŽã‚‹ã¹ãã§ã¯ãªã„ãŒã€åˆ¶ç´„ã¯å—ã‘å…¥ã‚Œãªãã¦ã¯ãªã‚‰ãªã„
- ä¾‹: UserRepository(Redis), OrderRepository(MySQL)

---

```go
type UserRepository struct {
    redis redis.Client
}

// Redisã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§IDæ¤œç´¢ä»¥å¤–ã®æ¤œç´¢æ©Ÿèƒ½ã¯ä½¿ãˆãªã„
func (repo UserRepository) FindByID(id UserID) User {
    data := repo.redis.Get(id)

    user := User{}
    json.Unmarshal(data, &user)

    return user
}
```

---

# ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ç®¡ç†

## ãƒ•ã‚¡ã‚¯ãƒˆãƒª

- è¤‡é›‘ã‹ã¤è©³ç´°ã‚’éš è”½ã—ãŸã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹
- åŸºæœ¬çš„ã«ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ãˆã°ã„ã„ãŸã‚ã€å¤šæ§˜ã™ã¹ãã§ã¯ãªã„
- é›†ç´„ã«ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€é–¢é€£ã®ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã‚‹

---

# ã‚µãƒãƒ¼ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- DDDã‚’å®Ÿè·µã™ã‚‹ã¨ãã«æœ‰åŠ¹ãªé“å…·ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
    - ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
    - CQRS (ã‚³ãƒžãƒ³ãƒ‰ã‚¯ã‚¨ãƒªè²¬å‹™åˆ†é›¢)
    - Event Sourcing

---

# ã‚µãƒãƒ¼ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ

- ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ç™ºç”Ÿã—ãŸ**éŽåŽ»ã®äº‹å®Ÿ**ã‚’è¡¨ã™
- éžåŒæœŸå‡¦ç†(çµæžœæ•´åˆæ€§)ã‚’è¡Œã†ãŸã‚ã®é“å…·
- Pub/Subã«ã‚ˆã£ã¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¼æ’­ã•ã›ã‚‹
- XXXã‚’ã—ãŸã¨ãã«YYYã‚’ã™ã‚‹ã¨ã„ã†è¦ä»¶ã«ãŠã„ã¦ã€XXXãŒå®Ÿè¡Œã•ã‚ŒãŸæ™‚ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œã—ã€éžåŒæœŸã§YYYã‚’å®Ÿè¡Œã™ã‚‹
- é›†ç´„é–“ã®æ•´åˆæ€§ã®ç¶­æŒã‚„åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®é€šçŸ¥ã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹
- ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚ŒãŸã‚‰Welcomeãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¦ãã ã•ã„

---

```go
// ã“ã®é–¢æ•°ã¯HTTPçµŒç”±ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚‚ã®ã¨ã™ã‚‹
func RegisterUser(name, email string) {
    user, event := NewUser(NewName(name), NewEmail(email))
    repository.Save(user)
    pubsub.Publish(event)
}

func NewUser(name Name, mail Email) (User, Event) {
    user := User{ ID: rand.Int(), Name: name, Email: mail }
    event := UserCreated{ ID: user.ID, Name: user.Name, Email: mail }
    return user, event
}

// ä»¥ä¸‹ã¯åˆ¥ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨ã™ã‚‹
func HandleUserCreated(event UserCreated) {
    mailer.SendWelcomeMail(event.Email, event.Name)
}

func main() {
   pubsub.Subscribe("user_created", HandleUserCreated)
}
```

---

# ã‚µãƒãƒ¼ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## CQRS (ã‚³ãƒžãƒ³ãƒ‰ã‚¯ã‚¨ãƒªè²¬å‹™åˆ†é›¢)

- ä¸€èˆ¬çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯1ã¤ã®ãƒ¢ãƒ‡ãƒ«ãŒãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã®è²¬å‹™ã‚’æŒã£ã¦ã„ã‚‹
- CQRSã§ã¯ã‚³ãƒžãƒ³ãƒ‰(æ›´æ–°å‡¦ç†)ã¨ã‚¯ã‚¨ãƒª(èª­è¾¼å‡¦ç†)ã®å®Ÿè£…ã‚’åˆ†é›¢ã™ã‚‹
- ãƒ¢ãƒ‡ãƒ«(ã‚³ãƒžãƒ³ãƒ‰å´)ãŒå˜ç´”åŒ–ã§ãã‚‹
    - GetterãŒæ¸›ã‚‹(ã®ã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’é–‰ã˜è¾¼ã‚ã‚„ã™ã„)
- ã‚¯ã‚¨ãƒªã«ç‰¹åŒ–ã—ãŸå®Ÿè£…ãŒã§ãã‚‹
    - èª­è¾¼ã§ãƒ‡ãƒ¼ã‚¿ãŒå£Šã‚Œã‚‹ã“ã¨ã¯ãªã„ã®ã§ã€ãƒ¢ãƒ‡ãƒ«ãªã©ã‚’çµŒç”±ã›ãšã«åŠ¹çŽ‡çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½
- ã‚³ãƒžãƒ³ãƒ‰å´ã¨ã‚¯ã‚¨ãƒªå´ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆ†ã‘ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã‚‹
    - ã“ã®å ´åˆã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚ˆã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åŒæœŸã™ã‚‹(çµæžœæ•´åˆæ€§)

---

![fit](./cqrs.png)

---

# ã‚µãƒãƒ¼ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## Event Sourcing

- ä¸€èˆ¬çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç¾åœ¨ã®çŠ¶æ…‹ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹
- Event Sourcingã§ã¯ä¸€é€£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã€èª­ã¿è¾¼ã¿æ™‚ã«ã¯ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰çŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹
- CQRSã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„(ç¾åœ¨ã®çŠ¶æ…‹ãŒãªã„ã®ã§JOINãªã©ãŒã§ããªã„ã®ã§èª­ã¿è¾¼ã¿ç”¨ã®DBã‚’ä½¿ã†)
- éŽåŽ»ã®ä»»æ„ã®æ™‚ç‚¹ã«ãŠã‘ã‚‹çŠ¶æ…‹ã‚’å†ç¾ã§ãã‚‹(éŽåŽ»ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ä»®èª¬æ¤œè¨¼ãªã©ãŒå¯èƒ½)
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®ä¿å­˜ã¨Publishã‚’Atomicã«å®Ÿè¡Œå¯èƒ½(ä¿å­˜ã—ãŸã‚‚ã®ã‚’Publishã§ãã‚‹ä»•çµ„ã¿ãŒã‚ã‚Œã°)

---

|Action|State Sourcing|Event Sourcing|
|:---|:---|:---|
|1.ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²  |`User{ID:123, Name:"tarou", Like: 0}` |`UserRegistered{UesrID:123, Name:"tarou"}`  |
|2.ã„ã„ã­ã•ã‚ŒãŸ  |`User{ID:123, Name:"tarou", Like: 1}` |`UserGotLike{UserID:123}`                   |
|3.ãƒ¦ãƒ¼ã‚¶ãƒ¼åå¤‰æ›´|`User{ID:123, Name:"hanako", Like: 1}`|`UserNameUpdated{UserID:123, Name:"hanako"}`|
|4.ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤  |`nil`                                 |`UserDeleted{UserID:123}`                   |

---

# ã¾ã¨ã‚

---

# ã¾ã¨ã‚

- DDDã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ç†è§£ã¨ãƒ“ã‚¸ãƒã‚¹ã®æˆé•·ã‚’æ”¯ãˆã‚‹
- ãƒ¢ãƒ‡ãƒ«ã¨ã‚³ãƒ¼ãƒ‰ã‚’ä¸€è‡´ã•ã›ã‚Œã°é–‹ç™ºã‚’åŠ é€Ÿã§ãã‚‹
- ç¶™ç¶šçš„ã«ãƒ¢ãƒ‡ãƒ«ã‚’è¦‹ç›´ã—ã€æ–°ã—ã„æ¦‚å¿µã‚’è¦‹ã¤ã‘å‡ºãã†
- ã„ãã¤ã‹ã®æˆ¦è¡“ãŒã‚ã‚‹ã®ã§ã€è‡ªåˆ†ãŸã¡ãŒä½¿ãˆã‚‹ã‚‚ã®ã ã‘å–ã‚Šå…¥ã‚Œã‚Œã°ã„ã„

---

# ãŠã™ã™ã‚ã®æœ¬

---

![right, fit](ee.jpeg)

## ã‚¨ãƒªãƒƒã‚¯ã‚¨ãƒ´ã‚¡ãƒ³ã‚¹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ
####[https://www.amazon.co.jp/dp/B00GRKD6XU](https://www.amazon.co.jp/dp/B00GRKD6XU)


---

![right, fit](iddd.jpeg)

## å®Ÿè·µãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ
####[https://www.amazon.co.jp/å®Ÿè·µãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ-ãƒ´ã‚¡ãƒ¼ãƒ³-ãƒ´ã‚¡ãƒ¼ãƒŽãƒ³-ebook/dp/B00UX9VJGW](https://www.amazon.co.jp/%E5%AE%9F%E8%B7%B5%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E9%A7%86%E5%8B%95%E8%A8%AD%E8%A8%88-%E3%83%B4%E3%82%A1%E3%83%BC%E3%83%B3-%E3%83%B4%E3%82%A1%E3%83%BC%E3%83%8E%E3%83%B3-ebook/dp/B00UX9VJGW)

---

![right, fit](eaa.jpeg)


## .NETã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
####[https://www.amazon.co.jp/NETã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç¬¬2ç‰ˆ-NETã‚’ä¾‹ã«ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆåŽŸå‰‡-ãƒ‡ã‚£ãƒŽ-ã‚¨ã‚¹ãƒã‚·ãƒˆ-ebook/dp/B00ZQZ8JNE](https://www.amazon.co.jp/NET%E3%81%AE%E3%82%A8%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%97%E3%83%A9%E3%82%A4%E3%82%BA%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E7%AC%AC2%E7%89%88-NET%E3%82%92%E4%BE%8B%E3%81%AB%E3%81%97%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E8%A8%AD%E8%A8%88%E5%8E%9F%E5%89%87-%E3%83%87%E3%82%A3%E3%83%8E-%E3%82%A8%E3%82%B9%E3%83%9D%E3%82%B7%E3%83%88-ebook/dp/B00ZQZ8JNE)

---

![right, fit](masuda.jpeg)

## ç¾å ´ã§å½¹ç«‹ã¤ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã®åŽŸå‰‡ ã€œå¤‰æ›´ã‚’æ¥½ã§å®‰å…¨ã«ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®å®Ÿè·µæŠ€æ³•
####[https://www.amazon.co.jp/dp/B073GSDBGT](https://www.amazon.co.jp/å®Ÿè·µãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ-ãƒ´ã‚¡ãƒ¼ãƒ³-ãƒ´ã‚¡ãƒ¼ãƒŽãƒ³-ebook/dp/B00UX9VJGW)

